define(function(require, exports, module){function r(){k.remove(n);c.clear();l=new b.Plane(h.width*c.width,h.height*c.height,h.segments,h.slices);s=new b.Material(h.ambient,h.diffuse);n=new b.Mesh(l,s);k.add(n);var d,a;for(d=l.vertices.length-1;0<=d;d--)a=l.vertices[d],a.anchor=b.Vector3.clone(a.position),a.step=b.Vector3.create(Math.randomInRange(.2,1),Math.randomInRange(.2,1),Math.randomInRange(.2,1)),a.time=Math.randomInRange(0,Math.PIM2)}function t(d,a){c.setSize(d,a);b.Vector3.set(q,c.halfWidth,c.halfHeight);r()}
function u(){p=Date.now()-C;var d,a,c,g,e,n=h.depth/2;b.Vector3.copy(f.bounds,q);b.Vector3.multiplyScalar(f.bounds,f.xyScalar);b.Vector3.setZ(m,f.zOffset);f.autopilot&&(d=Math.sin(f.step[0]*p*f.speed),a=Math.cos(f.step[1]*p*f.speed),b.Vector3.set(m,f.bounds[0]*d,f.bounds[1]*a,f.zOffset));for(d=k.lights.length-1;0<=d;d--)a=k.lights[d],b.Vector3.setZ(a.position,f.zOffset),c=Math.clamp(b.Vector3.distanceSquared(a.position,m),f.minDistance,f.maxDistance),c=f.gravity*a.mass/c,b.Vector3.subtractVectors(a.force,
m,a.position),b.Vector3.normalise(a.force),b.Vector3.multiplyScalar(a.force,c),b.Vector3.set(a.acceleration),b.Vector3.add(a.acceleration,a.force),b.Vector3.add(a.velocity,a.acceleration),b.Vector3.multiplyScalar(a.velocity,f.dampening),b.Vector3.limit(a.velocity,f.minLimit,f.maxLimit),b.Vector3.add(a.position,a.velocity);for(g=l.vertices.length-1;0<=g;g--)e=l.vertices[g],d=Math.sin(e.time+e.step[0]*p*h.speed),a=Math.cos(e.time+e.step[1]*p*h.speed),c=Math.sin(e.time+e.step[2]*p*h.speed),b.Vector3.set(e.position,
h.xRange*l.segmentWidth*d,h.yRange*l.sliceHeight*a,h.zRange*n*c-n),b.Vector3.add(e.position,e.anchor);l.dirty=!0;v();requestAnimationFrame(u)}function v(){c.render(k);if(f.draw){var b,a,e,g;for(b=k.lights.length-1;0<=b;b--)switch(g=k.lights[b],a=g.position[0],e=g.position[1],w.renderer){case "canvas":c.context.lineWidth=.5;c.context.beginPath();c.context.arc(a,e,10,0,Math.PIM2);c.context.strokeStyle=g.ambientHex;c.context.stroke();c.context.beginPath();c.context.arc(a,e,4,0,Math.PIM2);c.context.fillStyle=
g.diffuseHex;c.context.fill();break;case "svg":a+=c.halfWidth,e=c.halfHeight-e,g.core.setAttributeNS(null,"fill",g.diffuseHex),g.core.setAttributeNS(null,"cx",a),g.core.setAttributeNS(null,"cy",e),c.element.appendChild(g.core),g.ring.setAttributeNS(null,"stroke",g.ambientHex),g.ring.setAttributeNS(null,"cx",a),g.ring.setAttributeNS(null,"cy",e),c.element.appendChild(g.ring)}}}function D(d){b.Vector3.set(m,d.x,c.height-d.y);b.Vector3.subtract(m,q);f.autopilot=!f.autopilot}function E(d){b.Vector3.set(m,
d.x,c.height-d.y);b.Vector3.subtract(m,q)}function F(b){t(e.offsetWidth,e.offsetHeight);v()}var b=require("fss"),h={width:1,height:1,depth:10,segments:16,slices:8,xRange:.8,yRange:.1,zRange:1,ambient:"#dddddd",diffuse:"#FFFFFF",speed:.001},f={count:1,xyScalar:1,zOffset:60,ambient:"#efefef",diffuse:"#ffffff",speed:.01,gravity:1200,dampening:.95,minLimit:10,maxLimit:null,minDistance:20,maxDistance:400,autopilot:!1,draw:!0,bounds:b.Vector3.create(),step:b.Vector3.create(Math.randomInRange(.2,1),Math.randomInRange(.2,
1),Math.randomInRange(.2,1))},w={renderer:"canvas"},p,C=Date.now(),q=b.Vector3.create(),m=b.Vector3.create(),e=document.getElementById("container"),c,k,n,l,s,x,y,z;exports.init=function(){x=new b.WebGLRenderer;y=new b.CanvasRenderer;z=new b.SVGRenderer;var d=w.renderer;c&&e.removeChild(c.element);switch(d){case "webgl":c=x;break;case "canvas":c=y;break;case "svg":c=z}c.setSize(e.offsetWidth,e.offsetHeight);e.appendChild(c.element);k=new b.Scene;r();for(var a,d=k.lights.length-1;0<=d;d--)a=k.lights[d],
k.remove(a);c.clear();for(d=0;d<f.count;d++)a=new b.Light(f.ambient,f.diffuse),a.ambientHex=a.ambient.format(),a.diffuseHex=a.diffuse.format(),k.add(a),a.mass=Math.randomInRange(.5,1),a.velocity=b.Vector3.create(),a.acceleration=b.Vector3.create(),a.force=b.Vector3.create(),a.ring=document.createElementNS(b.SVGNS,"circle"),a.ring.setAttributeNS(null,"stroke",a.ambientHex),a.ring.setAttributeNS(null,"stroke-width","0.5"),a.ring.setAttributeNS(null,"fill","none"),a.ring.setAttributeNS(null,"r","10"),
a.core=document.createElementNS(b.SVGNS,"circle"),a.core.setAttributeNS(null,"fill",a.diffuseHex),a.core.setAttributeNS(null,"r","4");window.addEventListener("resize",F);e.addEventListener("click",D);e.addEventListener("mousemove",E);t(e.offsetWidth,e.offsetHeight);u()}});
